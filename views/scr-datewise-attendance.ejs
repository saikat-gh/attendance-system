<!DOCTYPE html>
<html>
<head>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .date-header {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .employee-separator {
            border-bottom: 1px dashed #ccc;
        }
        .date-separator {
            border-bottom: 2px solid #000;
        }
        .empty-cell {
            border: none;
        }
        .employee-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h2>Attendance Report (<%= startDate %> to <%= endDate %>)</h2>
    
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Employee Photo</th>
                <th>Employee Name</th>
                <th>In Time</th>
                <th>Out Time</th>
            </tr>
        </thead>
        <tbody>
            <% Object.entries(reportData).forEach(([date, employees]) => { %>
                <% let isFirstEmployeeForDate = true; %>
                <% let totalRowsForDate = Object.values(employees).reduce((acc, emp) => acc + emp.entries.length, 0); %>
                
                <% Object.entries(employees).forEach(([empName, data]) => { %>
                    <% data.entries.forEach((entry, entryIndex) => { %>
                        <tr>
                            <% if (isFirstEmployeeForDate && entryIndex === 0) { %>
                                <td rowspan="<%= totalRowsForDate %>">
                                    <% 
                                    const dateObj = new Date(date);
                                    if (!isNaN(dateObj)) {
                                        const day = String(dateObj.getDate()).padStart(2, '0');
                                        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                        const monthName = monthNames[dateObj.getMonth()];
                                        const year = dateObj.getFullYear();
                                    %>
                                        <%= `${day}-${monthName}-${year}` %>
                                    <% } else { %>
                                        Invalid Date
                                    <% } %>
                                </td>
                            <% } %>
                            
                            <% if (entryIndex === 0) { %>
                                <td rowspan="<%= data.entries.length %>">
                                    <img src="<%= data.fotourl %>" alt="<%= empName %>" class="employee-photo">
                                </td>
                                <td rowspan="<%= data.entries.length %>"><%= empName %></td>
                            <% } %>
                            
                            <td><%= entry.inTime %></td>
                            <td><%= entry.outTime %></td>
                        </tr>
                    <% }); %>
                    <% isFirstEmployeeForDate = false; %>
                <% }); %>
                
                <tr class="date-separator">
                    <td colspan="5"></td>
                </tr>
            <% }); %>
        </tbody>
    </table>
</body>
</html>